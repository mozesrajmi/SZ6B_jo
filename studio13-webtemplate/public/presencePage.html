<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Kezelési Napok</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.3/css/dataTables.dataTables.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.3/js/dataTables.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="presencePage.css">
</head>
<body>
    <div class="container">
        <h2 id="patientNameTitle">Kezelési napok</h2>
        <table id="daysTable" class="display" style="width:60%">
            <thead>
                <tr>
                    <th>Hónap</th>
                    <th>Napok</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dinamikusan generált sorok (NAPOK rekordok) -->
            </tbody>
        </table>
        <div id="gombos">
            <input type="button" value="Jelenlegi hó szerkesztése">
        </div>
    </div>

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const patientName = urlParams.get('name');

            // Naplózzuk ki a nevet, hogy megbizonyosodjunk róla
            console.log("Keresett páciens neve:", patientName);

            if (patientName) {
                document.getElementById('patientNameTitle').innerText = `${patientName} kezelési napjai`;
            } else {
                console.error("Nem sikerült kiolvasni a páciens nevét az URL-ből.");
            }

            // Az AJAX kérés a kezelés napjainak lekérésére
            $.ajax({
                url: 'http://localhost:3000/getTreatmentDays',
                method: 'GET',
                data: { name: patientName },
                success: function(response) {
                    console.log("Visszakapott napok adatok:", response);
            
                    if (response && response.days) {
                        const tableBody = $('#daysTable tbody');
            
                        response.days.forEach(day => {
                            const row = $('<tr></tr>');
                            row.append(`<td class='sajt'>${day.hónap}</td>`);
                            row.append(`<td class='sajt'>${day.NAPOK}</td>`);
                            tableBody.append(row);
                        });
            
                        $('#daysTable').DataTable({
                            searching: false,
                            paging: false,
                            info: false,
                            ordering: false,
                        });
                    } else {
                        console.error("Nem található 'napok' adat a válaszban.");
                    }
                },
                error: function(xhr, status, error) {
                    console.error("Hiba történt az AJAX kérés során:", status, error);
                }
            });
        });

        // Modal létrehozása
        const modalHtml = `
            <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">Megerősítés</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Biztosan szerkeszteni akarja a jelenlegi hónapot?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Mégse</button>
                    <button type="button" class="btn btn-primary" id="confirmEdit">Igen</button>
                </div>
                </div>
            </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modalHtml);

        // Gomb esemény kezelése
        document.querySelector('#gombos input').addEventListener('click', function() {
            const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
            confirmationModal.show();
        });

        // Modal megerősítés gomb esemény kezelése
        document.getElementById('confirmEdit').addEventListener('click', function() {
            window.location.href = 'editCurrentMonth.html';
        });


    </script>
</body>
</html>
