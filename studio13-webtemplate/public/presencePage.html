<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Kezelési Napok</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.3/css/dataTables.dataTables.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.3/js/dataTables.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="container">
        <h2 id="patientNameTitle">Kezelési napok</h2>
        <table id="daysTable" class="display table table-striped" style="width:100%">
            <thead>
                <tr>
                    <!-- Dinamikusan generált oszlopok (napok) kerülnek ide -->
                </tr>
            </thead>
            <tbody>
                <!-- Dinamikusan generált sorok (NAPOK rekordok) -->
            </tbody>
        </table>
    </div>

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const patientName = urlParams.get('name');

            // Naplózzuk ki a nevet, hogy megbizonyosodjunk róla
            console.log("Keresett páciens neve:", patientName);

            if (patientName) {
                document.getElementById('patientNameTitle').innerText = `${patientName} kezelési napjai`;
            } else {
                console.error("Nem sikerült kiolvasni a páciens nevét az URL-ből.");
            }
            
            // Az AJAX kérés a kezelés napjainak lekérésére
            $.ajax({
                url: 'http://localhost:3000/getTreatmentDays',
                method: 'GET',
                data: { name: patientName },
                success: function(response) {
                    console.log("Visszakapott napok adatok:", response);
            
                    if (response && response.days) {
                        const daysArray = response.days.split(''); // Split the string into an array
                        const tableHeader = $('#daysTable thead tr');
                        const tableBody = $('#daysTable tbody');
            
                        for (let i = 0; i < daysArray.length; i++) {
                            tableHeader.append(`<th>Nap ${i + 1}</th>`);
                        }
            
                        const row = $('<tr></tr>');
                        daysArray.forEach(day => {
                            row.append(`<td>${day}</td>`);
                        });
                        tableBody.append(row);
            
                        $('#daysTable').DataTable({
                            searching: false,
                            paging: false,
                            info: false
                        });
                    } else {
                        console.error("Nem található 'napok' adat a válaszban.");
                    }
                },
                error: function(xhr, status, error) {
                    console.error("Hiba történt az AJAX kérés során:", status, error);
                }
            });
        });
    </script>
</body>
</html>
